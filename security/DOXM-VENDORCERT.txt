/*
@startuml
autonumber
title OCF Device Owner Establishment Sequence \n"Vendor Cert" Device Owner Transfer Method
participant "Onboarding Tool\n(UUID B0B0XXXX-...)" as OT
participant "New Device\n(UUID A21CXXXX-...)" as ND

==Device Owner Transfer Method==
note over OT, ND
Find new devices that are unowned and choose the Vendor Cert owner transfer method.
end note
OT->ND: GET /oic/sec/doxm?owned=FALSE
ND->OT: RSP {"oxms":[0XFF00,..., 0xFFFF], "owned":FALSE, "deviceuuid":"A21CXXXX-...","sct":1}
OT->ND: POST /oic/sec/doxm {"oxmsel":0XFF00}
ND->OT: RSP 2.04

==Perform oic.sec.oxm.vendorcert method==

note over OT, ND
The OBT decides which credential type(S) will be used to establish owner credential.
If a symmetric credential type was selected, independently derive a shared symmetric key
end note
OT->OT: OwnerPSK = PRF (MasterSecret, "oic.sec.oxm.vendorcert", "uuid":"B0B0XXXX-...", "uuid":"A21CXXXX-...", "63")
OT->OT: Generate /oic/sec/cred {"creds":[{"credtype":1, "subjectuuid":"A21CXXXX-...", "credid":1,\n "privatedata":{"encoding":"oic.sec.encoding.bas64", "data":'<raw data of SharedKey>'},...}], "rowneruuid":"B0B0XXXX-..."}
OT->ND: POST /oic/sec/cred {"creds":[{"credtype":1, "subjectuuid":"B0B0XXXX-...", "credid":1,\n "privatedata":{"encoding":"oic.sec.encoding.bas64", "data":'<empty>'},...}], "rowneruuid":"B0B0XXXX-..."}
ND->ND: Derive OwnerPSK Locally
ND->ND: Verify OwnerPSK Match
ND->OT: RSP 2.04

note over OT, ND
If an asymmetric or certificate credential type was selected, provision the OBT public key to the device and register the device's public key
end note
OT->ND: POST /oic/sec/cred {"creds":[{"credtype":32, "subjectuuid":"B0B0XXXX-...", "credid":2,\n "publicdata":{"encoding":"oic.sec.encoding.pem", "data":"<owner-pub-key-pem>"},...}], "rowneruuid":"B0B0XXXX-..."}
ND->OT: RSP 2.04
ND->ND: Generate Key Pair
OT->ND: GET /oic/sec/cred?subjectuuid="A21CXXXX-..."
ND->OT: RSP {"creds":[{..., "credtype":32, "subjectuuid":"A21CXXXX-...", "credid":1,\n "publicdata":{"encoding":"oic.sec.encoding.pem", "data":"<device-pub-key-pem>"},...}], "rowneruuid":"B0B0XXXX-..."}

note over OT, ND
If certificate credential type was selected, issue a device certificate to the new device
end note
OT<->ND: Perform asymmetric credential exchange above
OT->ND: POST /oic/sec/cred {"creds":[{"credtype":8, "subjectuuid":"A21CXXXX-...", "credid":2,\n "publicdata":{"encoding":"oic.sec.encoding.pem", "data":"<certificate-data-pem>"},...}], "rowneruuid":"B0B0XXXX-..."}
ND->OT: RSP 2.04

note over OT, ND
Assign valid "rowneruuid" to each implemented security resource (not shown).
end note

note over OT, ND
Update the owned status. Device is now ready to move to provisioning and "RFPRO" state.
end note
OT->ND: POST /oic/sec/doxm {"owned":TRUE}
ND->OT: RSP 2.04

note over OT, ND
Move device to RFPRO state.
end note
OT->ND: POST /oic/sec/pstat {"dos":{"s":2}}
ND->OT: RSP 2.04

note over OT, ND
Provision the new device with additional credentials for device management and device-to-device communications (not shown).
end note

note over OT, ND
Enter "RFNOP" state to enable normal operation.
end note
OT->ND: POST /oic/sec/pstat {"dos":{"s":3}}
ND->OT: RSP 2.04

@enduml
*/
